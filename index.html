<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Color Changer</title>
  <style>
    :root {
      --bg-ctrl: rgba(255,255,255,0.75);
      --bd-ctrl: rgba(0,0,0,0.1);
      --txt: #0b0b0b;
      --muted: #5b5b5b;
      --accent: #2563eb;
      --accent-contrast: #ffffff;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Apple Color Emoji, Segoe UI Emoji;
      color: var(--txt);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      background: #ffffff;
    }
    .controls {
      position: sticky;
      top: 0;
      z-index: 2;
      display: flex;
      gap: .5rem;
      align-items: center;
      padding: .75rem;
      background: var(--bg-ctrl);
      -webkit-backdrop-filter: blur(8px);
      backdrop-filter: blur(8px);
      border-bottom: 1px solid var(--bd-ctrl);
    }
    .controls h1 {
      margin: 0 0 0 .25rem;
      font-size: 1rem;
      font-weight: 600;
      color: var(--muted);
    }
    .spacer { flex: 1; }
    label {
      font-size: .9rem;
      color: var(--muted);
    }
    .input-wrap {
      display: flex;
      align-items: center;
      gap: .4rem;
      padding: .35rem .5rem;
      border: 1px solid var(--bd-ctrl);
      border-radius: .5rem;
      background: #fff;
    }
    .input-wrap input {
      width: 8.5ch;
      border: none;
      outline: none;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size: 1rem;
      text-transform: uppercase;
    }
    .btn {
      appearance: none;
      border: 1px solid var(--bd-ctrl);
      background: #fff;
      color: var(--txt);
      padding: .5rem .75rem;
      border-radius: .5rem;
      font-weight: 600;
      cursor: pointer;
      transition: transform .05s ease, box-shadow .15s ease, background .15s ease;
    }
    .btn:hover { box-shadow: 0 2px 10px rgba(0,0,0,0.08); }
    .btn:active { transform: translateY(1px); }
    .btn.primary {
      background: var(--accent);
      color: var(--accent-contrast);
      border-color: transparent;
    }
    .note {
      font-size: .85rem;
      color: var(--muted);
      margin-left: .25rem;
    }
    .status {
      min-width: 70px;
      text-align: right;
      font-size: .85rem;
      color: var(--muted);
    }
    .preview {
      position: relative;
      flex: 1;
      display: grid;
      place-items: center;
      padding: 2rem 1rem;
      transition: background-color .2s ease;
    }
    .code-display {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size: clamp(2rem, 9vw, 8rem);
      letter-spacing: .05em;
      font-weight: 700;
      user-select: text;
      border-radius: .75rem;
      padding: .35em .5em;
      background: rgba(255,255,255,0.0);
      outline: 2px dashed rgba(255,255,255,0.0);
      transition: color .15s ease, text-shadow .15s ease, outline-color .15s ease, background .15s ease;
    }
    .tip {
      position: absolute;
      bottom: 1rem;
      left: 50%;
      transform: translateX(-50%);
      font-size: .9rem;
      color: rgba(0,0,0,0.6);
      padding: .35rem .55rem;
      border-radius: .5rem;
      background: rgba(255,255,255,0.65);
      -webkit-backdrop-filter: blur(8px);
      backdrop-filter: blur(8px);
    }
    .toast {
      position: fixed;
      inset-inline: 0;
      bottom: 1rem;
      margin: 0 auto;
      width: max-content;
      max-width: calc(100% - 2rem);
      background: rgba(20,20,20,.9);
      color: #fff;
      padding: .5rem .75rem;
      border-radius: .5rem;
      font-size: .9rem;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
      opacity: 0;
      transform: translateY(10px);
      transition: opacity .18s ease, transform .18s ease;
      pointer-events: none;
    }
    .toast.show {
      opacity: 1;
      transform: translateY(0);
    }
    @media (max-width: 520px) {
      .controls { flex-wrap: wrap; gap: .6rem .5rem; }
      .status { order: 99; width: 100%; text-align: left; min-width: 0; }
      .spacer { display: none; }
    }
  </style>
</head>
<body>
  <div class="controls" role="region" aria-label="Color controls">
    <h1>Color Changer</h1>
    <div class="spacer" aria-hidden="true"></div>

    <div class="input-wrap" title="Enter a hex color (e.g. #34D399 or 34D399 or 3D9)">
      <label for="hexInput">Hex</label>
      <input id="hexInput" type="text" value="#FF5733" inputmode="text" autocomplete="off" aria-label="Hex color input" />
    </div>

    <button id="applyBtn" class="btn" title="Apply typed hex color">Apply</button>
    <button id="randomBtn" class="btn primary" title="Get a random color">Random</button>
    <button id="copyBtn" class="btn" title="Copy the current hex code">Copy code</button>

    <div class="status" id="status" aria-live="polite"></div>
  </div>

  <main id="preview" class="preview" role="img" aria-label="Color preview. Click anywhere or press Space to randomize.">
    <div id="codeDisplay" class="code-display" aria-live="polite">#FF5733</div>
    <div class="tip">Tip: Click anywhere or press Space to randomize</div>
  </main>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script>
    const hexInput = document.getElementById('hexInput');
    const applyBtn = document.getElementById('applyBtn');
    const randomBtn = document.getElementById('randomBtn');
    const copyBtn = document.getElementById('copyBtn');
    const preview = document.getElementById('preview');
    const codeDisplay = document.getElementById('codeDisplay');
    const statusEl = document.getElementById('status');
    const toast = document.getElementById('toast');

    function showToast(message) {
      toast.textContent = message;
      toast.classList.add('show');
      clearTimeout(showToast._t);
      showToast._t = setTimeout(() => toast.classList.remove('show'), 1300);
    }

    function randomHexColor() {
      const bytes = self.crypto && crypto.getRandomValues ? crypto.getRandomValues(new Uint8Array(3)) : new Uint8Array([Math.random()*256|0, Math.random()*256|0, Math.random()*256|0]);
      return '#' + Array.from(bytes).map(b => b.toString(16).padStart(2,'0')).join('').toUpperCase();
    }

    function normalizeHex(v) {
      if (!v && v !== 0) return null;
      let s = String(v).trim();
      if (s.startsWith('#')) s = s.slice(1);
      if (/^[0-9a-fA-F]{3}$/.test(s)) {
        s = s.split('').map(ch => ch + ch).join('');
      } else if (/^[0-9a-fA-F]{6}$/.test(s)) {
        // ok
      } else {
        return null;
      }
      return '#' + s.toUpperCase();
    }

    function hexToRgb(hex) {
      const n = normalizeHex(hex);
      if (!n) return null;
      const r = parseInt(n.slice(1,3), 16);
      const g = parseInt(n.slice(3,5), 16);
      const b = parseInt(n.slice(5,7), 16);
      return { r, g, b };
    }

    function contrastColor(hex) {
      const rgb = hexToRgb(hex);
      if (!rgb) return '#000000';
      const yiq = (rgb.r * 299 + rgb.g * 587 + rgb.b * 114) / 1000;
      return yiq >= 128 ? '#000000' : '#FFFFFF';
    }

    function setColor(hex, announce = true) {
      const valid = normalizeHex(hex);
      if (!valid) return false;

      preview.style.backgroundColor = valid;
      codeDisplay.textContent = valid;
      const fg = contrastColor(valid);
      codeDisplay.style.color = fg;
      const shadow = fg === '#000000' ? 'rgba(255,255,255,.35)' : 'rgba(0,0,0,.35)';
      codeDisplay.style.textShadow = `0 1px 4px ${shadow}`;
      codeDisplay.style.outlineColor = fg === '#000000' ? 'rgba(0,0,0,.1)' : 'rgba(255,255,255,.2)';
      codeDisplay.style.background = fg === '#000000' ? 'rgba(255,255,255,.08)' : 'rgba(0,0,0,.08)';

      hexInput.value = valid;
      document.title = `Color: ${valid}`;
      statusEl.textContent = '';
      try { localStorage.setItem('lastColor', valid); } catch {}
      if (location.hash.slice(1).toUpperCase() !== valid.slice(1).toUpperCase()) {
        history.replaceState(null, '', '#' + valid.slice(1));
      }
      if (announce) {
        // small non-intrusive status for screen readers
        statusEl.textContent = `Set to ${valid}`;
      }
      return true;
    }

    function applyFromInput() {
      const val = hexInput.value;
      const normalized = normalizeHex(val);
      if (!normalized) {
        statusEl.textContent = 'Invalid hex';
        hexInput.focus();
        hexInput.select();
        return;
      }
      setColor(normalized);
    }

    function initFromHashOrStorage() {
      const fromHash = normalizeHex(location.hash.replace('#', ''));
      if (fromHash) return setColor(fromHash, false);
      try {
        const fromStore = normalizeHex(localStorage.getItem('lastColor'));
        if (fromStore) return setColor(fromStore, false);
      } catch {}
      return setColor(randomHexColor(), false);
    }

    // Events
    applyBtn.addEventListener('click', applyFromInput);
    randomBtn.addEventListener('click', () => setColor(randomHexColor()));
    copyBtn.addEventListener('click', async () => {
      const code = codeDisplay.textContent.trim();
      try {
        await navigator.clipboard.writeText(code);
        showToast(`Copied ${code}`);
      } catch {
        // Fallback
        const ta = document.createElement('textarea');
        ta.value = code;
        document.body.appendChild(ta);
        ta.select();
        try {
          document.execCommand('copy');
          showToast(`Copied ${code}`);
        } catch {}
        document.body.removeChild(ta);
      }
    });

    hexInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') applyFromInput();
    });

    preview.addEventListener('click', (e) => {
      if (e.target === copyBtn) return;
      setColor(randomHexColor());
    });

    window.addEventListener('keydown', (e) => {
      if (['INPUT', 'TEXTAREA'].includes(document.activeElement?.tagName)) return;
      if (e.code === 'Space') {
        e.preventDefault();
        setColor(randomHexColor());
      } else if (e.key.toLowerCase() === 'c' && (e.ctrlKey || e.metaKey)) {
        copyBtn.click();
      }
    });

    window.addEventListener('hashchange', () => {
      const fromHash = normalizeHex(location.hash.replace('#', ''));
      if (fromHash) setColor(fromHash);
    });

    // Kick-off
    initFromHashOrStorage();
  </script>
</body>
</html>